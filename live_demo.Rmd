
```{r}
# define the modules
modules <- data.frame(
  "component" = c("select", "select", "transform", "plot", "plot"),
  "long_component" = c("Select data", "Select data", "Transform data", "Plot data", "Plot data"),
  "module" = c("async", "query", "filter", "hist", "scatter"),
  "long_module" = c("Upload your own data", "Query a database to obtain data", "Filter the data",
                    "Plot the data as a histogram", "Plot the data as a scatterplot"),
  "map" = c(TRUE, FALSE, TRUE, FALSE, FALSE),
  "result" = c(FALSE, FALSE, TRUE, TRUE, TRUE),
  "rmd" = c(TRUE, TRUE, TRUE, TRUE, TRUE),
  "save" = c(TRUE, TRUE, TRUE, TRUE, TRUE),
  "download" = c(FALSE, FALSE, TRUE, TRUE, TRUE),
  "async" = c(TRUE, FALSE, FALSE, FALSE, FALSE))

common_objects = c("raster", "histogram", "scatter")

# create the app
shinyscholar::create_template(path = file.path("~", "Documents"), name = "SSdemo",
                             include_map = TRUE, include_table = TRUE, include_code = TRUE,
                             common_objects = common_objects, modules = modules,
                             author = "Simon Smart", install = TRUE)

SSdemo::run_SSdemo()

```


```{r}
# copy modules from shinyscholar example app
select <- list.files(path = system.file("shiny", "modules", package = "shinyscholar"), pattern = "select_", full.names = TRUE)
plot_hist <- list.files(path = system.file("shiny", "modules", package = "shinyscholar"), pattern = "plot_hist", full.names = TRUE)
plot_scat <- list.files(path = system.file("shiny", "modules", package = "shinyscholar"), pattern = "plot_scat", full.names = TRUE)
 
for (f in c(select, plot_hist, plot_scat)){
  file.copy(f, file.path("~", "Documents", "SSdemo", "inst", "shiny", "modules"), overwrite = TRUE)
}

# copy functions 
functions <- c("select_async", "select_query", "select_user", "plot_hist", "plot_scatter")

for (f in functions){
  url <- glue::glue("https://raw.githubusercontent.com/simon-smart88/shinyscholar/refs/heads/master/R/{f}_f.R")
  download.file(url, file.path("~", "Documents", "SSdemo", f, "_f.R"))
}

```


```{r}

# load raster from saved common
#common <- readRDS("demo-session-2025-06-07.rds")

common <- readRDS(file.path("~", "Downloads", "shinyscholar-session-2025-02-06.rds"))

# only need for terra objects 
raster <- terra::unwrap(common$raster)

upper <- 90
lower <- 30

modified_raster <- terra::clamp(raster, lower = lower, upper = upper)

modified_raster

terra::plot(modified_raster)

```
